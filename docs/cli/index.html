<!doctype html><html lang=en><head><title>CLI reference - TestAndSet</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google content="notranslate"><link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700,700i" rel=stylesheet><link rel=stylesheet href=/assets/css/main.css><link rel=stylesheet href=/css/swagger-css/swagger-ui.css type=text/css></head><body><div id=page class="site palette-blue"><header id=masthead class="site-header outer"><div class=inner><div class=site-header-inside><div class=site-branding><p class=site-logo><a href=/><img src=/images/Copy%20of%20Test%20and%20Set%20%288%29.png alt=Logo></a></p><p class=site-title><a href=/>TestAndSet</a></p></div><nav id=main-navigation class=site-navigation aria-label="Main Navigation"><div class=site-nav-inside><button id=menu-close class=menu-toggle><span class=screen-reader-text>Open Menu</span><span class=icon-close aria-hidden=true></span></button><ul class=menu><li class=menu-item><a href=/>Home</a></li><li class=menu-item><a href=/demo>Demo</a></li><li class="menu-item menu-button"><a href=/docs/ class=button>Documentation</a></li></ul></div></nav><button id=menu-open class=menu-toggle><span class=screen-reader-text>Close Menu</span><span class=icon-menu aria-hidden=true></span></button></div></div></header><main id=content class=site-content><div class=outer><div class=inner-medium><article class="post post-full"><header class=post-header><h1 class=post-title>CLI reference</h1></header><div class=post-content><p>The open source CLI for TestAndSet allows you to call the TestAndSet API with an ease. It is simple in usage with all needed commands (lock, get, refresh, unlock and auto-refresh). For validating the owner of a mutex a token is used which must be provided in the refresh, auto-refresh and unlock command.</p><h2 id=installation>Installation</h2><p>You can get the binary on the <a href=https://github.com/maindev/testandset/releases>releases page of our repository</a> or <a href=/docs/cli/building-from-source>build from source</a>.</p><h2 id=available-commands>Available commands</h2><h3 id=lock>Lock</h3><p>Create your mutex with your custom key. There are some options for setting your lock with the CLI. The output can be a json-object or the pure refresh token. You can set a timeout, in which lock automatically tries to lock again at intervals. And you can also set an owner or some non-confidential data in the owner property.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ testandset mutex lock --name $MUTEX_NAME --output <span style=color:#f92672>[</span>json|token<span style=color:#f92672>]</span>
    --timeout $TIMEOUT_IN_SECONDS --owner $MUTEX_OWNER_NAME
</code></pre></div><blockquote><p>Please keep in mind that everyone who will try to obtain mutex with the same name will be able to see the <code>owner</code> property. Don&rsquo;t put sensitive data there.</p></blockquote><h3 id=get>Get</h3><p>You can check if a mutex with a specific name currently exists.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ testandset mutex get --name $MUTEX_NAME<span style=color:#e6db74>&#34;
</span></code></pre></div><h3 id=refresh>Refresh</h3><p>You can refresh an existing mutex for a small amount of time. To check that you are allowed to refresh you need the token provided by the lock command.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ testandset mutex refresh --name $MUTEX_NAME --token $TOKEN<span style=color:#e6db74>&#34;
</span></code></pre></div><h3 id=unlock>Unlock</h3><p>You can unlock an existing mutex to free it for other users when your work is done. To check that you are allowed to unlock you need the token provided by the lock command.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ testandset mutex unlock --name $MUTEX_NAME --token $TOKEN<span style=color:#e6db74>&#34;
</span></code></pre></div><h3 id=auto-refresh>Auto-refresh</h3><p>You can automatically let your script refresh an existing mutex at intervals. When this command is stopped it will automatically unlock the mutex. To check that you are allowed to auto-refresh you need the token provided by the lock command.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ testandset mutex auto-refresh --name $MUTEX_NAME --token $TOKEN<span style=color:#e6db74>&#34;
</span></code></pre></div><h2 id=example>Example</h2><p>Here is an example shell script how you can use TestAndSet CLI:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash -eu
</span><span style=color:#75715e></span>
MUTEX_NAME<span style=color:#f92672>=</span>maindev-mutext-example-1
TOKEN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>./TestAndSet mutex lock --name $MUTEX_NAME --output token --timeout 120<span style=color:#66d9ef>)</span>
./TestAndSet mutex auto-refresh --name $MUTEX_NAME --token $TOKEN &amp;
PID<span style=color:#f92672>=</span>$!
trap <span style=color:#e6db74>&#34;kill -TERM </span>$PID<span style=color:#e6db74>&#34;</span> EXIT

echo <span style=color:#e6db74>&#34;Doing something important!&#34;</span>
sleep <span style=color:#ae81ff>20</span>
echo <span style=color:#e6db74>&#34;Done.&#34;</span>
</code></pre></div></div></article></div></div></main><footer id=colophon class=site-footer><div class="footer-top outer"><div class=inner><div class=footer-widgets><div class="widget footer-branding"><p class=site-logo><a href=/><img src=/images/Copy%20of%20Test%20and%20Set%20%285%29.png alt=Logo></a></p><p class=site-description>Lock mechanism that simply works</p></div><nav class="widget footer-navigation"><div class=footer-nav-inside><div class=secondary-nav><h2 class=widget-title>Company</h2><ul class=secondary-menu><li><a href=/contact>Contact</a></li><li><a href=/terms-and-conditions/>Terms and Conditions</a></li><li><a href=/privacy-policy/>Privacy Policy</a></li></ul></div><div class=social-nav><h2 class=widget-title>Community</h2><ul class=social-links><li><a href=https://twitter.com/ target=_blank rel=noopener>Twitter</a></li><li><a href=https://www.instagram.com/ target=_blank rel=noopener>Instagram</a></li><li><a href=https://www.linkedin.com/ target=_blank rel=noopener>LinkedIn</a></li></ul></div></div></nav></div></div></div><div class="site-info outer"><div class=inner><a href=https://main.dev>&copy; 2020 Main Development GmbH All rights reserved.</a>
&nbsp;</div></div></footer></div><script src=/js/plugins.js></script><script src=/js/init.js></script><script src=/js/main.js></script></body></html>